!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestión de Mascotas</title>
    <link rel="stylesheet" href="gestion.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
</head>
<body>
    <header class="header">
        <div class="logo-container">
            <img src="img/Logo negro.png" alt="Logo" class="logo">
        </div>
        <h1 class="titulo-header">Gestión de Mascotas</h1>
    </header>

    <div class="container">
        <button class="boton-nueva-mascota" id="btnNuevaMascota">+ Nueva Mascota</button>
        <input type="text" class="buscador" placeholder="Buscar por nombre o dueño..." onkeyup="filtrarMascotas()">
        <div class="mascotas-grid" id="mascotas"></div>
    </div>

    <div id="modalRegistro" class="modal">
        <div class="modal-content">
            <span class="close-button">&times;</span>
            <h2>Registrar Nueva Mascota</h2>
            <form id="formularioRegistro">
                <label for="nombre">Nombre:</label>
                <input type="text" id="nombre" name="nombre" required>

                <label for="raza">Raza:</label>
                <input type="text" id="raza" name="raza">

                <label for="genero">Género:</label>
                <select id="genero" name="genero">
                    <option value="Macho">Macho</option>
                    <option value="Hembra">Hembra</option>
                    <option value="Desconocido">Desconocido</option>
                </select>

                <label for="dueño">Dueño:</label>
                <input type="text" id="dueño" name="dueño" required>

                <div>
                    <label>Seleccionar Imagen:</label>
                    <div>
                        <label for="imagenURL">Desde URL:</label>
                        <input type="text" id="imagenURL" name="imagenURL" placeholder="Ingresa la URL de la imagen">
                    </div>
                    <div class="file-upload-wrapper">
                        <label for="imagenArchivo" class="file-upload-button">Elegir Archivo</label>
                        <input type="file" id="imagenArchivo" name="imagenArchivo" accept="image/*" class="file-upload-input">
                        <span id="file-upload-filename"></span>
                    </div>
                </div>

                <button type="submit">Registrar</button>
            
            </form>
            
        </div>
        
    </div>
    <div class="navigation">
        <button onclick="history.back()" class="back-button">← Volver</button>
    </div>
    <script>
        const mascotasIniciales = [
            { nombre: "Max", raza: "Labrador", dueño: "Pedro Gómez", imagen: "https://www.bonza.dog/wp-content/uploads/Labrador-Dog-Health-Issues-Comprehensive-Guide-to-Common-Problems.webp", genero: "Macho" },
           { nombre: "Penny", raza: "Sphynx", dueño: "Pedro Gomez", imagen: "https://www.purina.es/sites/default/files/2021-02/CAT%20HERO_0026_Sphynx.jpg", genero: "Hembra" },
        ];

        function filtrarMascotas() {
            const input = document.querySelector('.buscador').value.toLowerCase();
            const cards = document.querySelectorAll('.mascota-card');

            cards.forEach(card => {
                const nombre = card.querySelector('h3').innerText.toLowerCase();
                const dueño = card.querySelector('.dueño').innerText.toLowerCase();
                card.style.display = (nombre.includes(input) || dueño.includes(input)) ? "flex" : "none";
            });
        }

        const modal = document.getElementById("modalRegistro");
        const btnNuevaMascota = document.getElementById("btnNuevaMascota");
        const spanCerrar = document.querySelector(".close-button");
        const formularioRegistro = document.getElementById("formularioRegistro");
        const mascotasGrid = document.getElementById("mascotas");
        const imagenURLInput = document.getElementById("imagenURL");
        const imagenArchivoInput = document.getElementById("imagenArchivo");
        const fileUploadFilename = document.getElementById("file-upload-filename");

        btnNuevaMascota.onclick = () => modal.style.display = "block";
        spanCerrar.onclick = () => modal.style.display = "none";
        window.onclick = event => { if (event.target == modal) modal.style.display = "none"; };

        formularioRegistro.addEventListener('submit', function(event) {
            event.preventDefault();
            const nombre = document.getElementById('nombre').value;
            const raza = document.getElementById('raza').value;
            const genero = document.getElementById('genero').value;
            const dueño = document.getElementById('dueño').value;
            let imagenSrc = '';

            if (imagenURLInput.value) {
                imagenSrc = imagenURLInput.value;
            } else if (imagenArchivoInput.files && imagenArchivoInput.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    imagenSrc = e.target.result;
                    agregarMascota(nombre, raza, genero, dueño, imagenSrc);
                    formularioRegistro.reset();
                    modal.style.display = "none";
                }
                reader.readAsDataURL(imagenArchivoInput.files[0]);
                return;
            } else {
                imagenSrc = 'https://placekitten.com/200/200';
            }

            agregarMascota(nombre, raza, genero, dueño, imagenSrc);
            formularioRegistro.reset();
            modal.style.display = "none";
        });

        function agregarMascota(nombre, raza, genero, dueño, imagen) {
            const nuevaCard = document.createElement('div');
            nuevaCard.classList.add('mascota-card');
            nuevaCard.innerHTML = `
                <img src="${imagen}" alt="${nombre}">
                <div class="info-container">
                    <h3>${nombre}</h3>
                    <p class="raza"><i class="fas fa-paw"></i> Raza: ${raza}</p>
                    <p class="genero"><i class="fas fa-venus-mars"></i> Género: ${genero}</p>
                    <p class="dueño"><i class="fas fa-user"></i> Dueño: ${dueño}</p>
                </div>
                <div class="acciones">
                    <button class="btn-ver-perfil">Ver Perfil</button>
                </div>
            `;
            nuevaCard.querySelector('.btn-ver-perfil').addEventListener('click', () => {
                const mascotaData = { nombre, raza, genero, dueño, imagen };
                localStorage.setItem('mascotaSeleccionada', JSON.stringify(mascotaData));
                window.location.href = 'perfil.html';
            });
            mascotasGrid.appendChild(nuevaCard);
        }

        mascotasIniciales.forEach(mascota => {
            agregarMascota(mascota.nombre, mascota.raza, mascota.genero, mascota.dueño, mascota.imagen);
        });

        imagenArchivoInput.addEventListener('change', function() {
            fileUploadFilename.textContent = this.files && this.files[0] ? this.files[0].name : '';
        });
    </script>
    
    
</body>
</html>
